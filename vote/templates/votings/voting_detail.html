{% extends 'base.html' %}
{% load humanize %}

{% block title %} Home {% endblock title %}

{% block content %}
  <div id='alert' class="alert alert-warning alert-dismissible fade show" role="alert" style="display: none;"> 
    <strong>Warning!</strong> It seems that you not logged in
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
    <div class="container">
        <div class="container-xl big-padding">
            <div class="col section-title text-center">
                <h2 class="fs-4">{{ voting.title }}</h2>
                <p class="text-center" style="word-wrap: break-word;">{{ voting.description }}</p>
            </div>
            <div class="row">
                {% for option in options %}
                <div class="col-lg-4 col-md-6">
                    <div class="text-dark text-center mb-1 votcard shadow-md bg-white p-4 pt-5">
                        <h4 class="mt-3 fs-5 mb-1 fw-bold">{{option.option_value}}</h4>
                        <p class="text-dark mt-3 mb-3 fs-8">Aliquam utrum nibh rutrum nibh vitae tortor
                            dapibus egestas. Cras condimentum dapibus tellus vel semper. Quisque vel dui
                            molestie est auctor utrum nibh porttitor.</p>
                          {% if option.voted %}
                            <button class="btn btn-success fw-bolder px-4 ms-2 fs-8 voted-option" data-id={{option.id}}>Voted</button>
                          {% else %}
                            <button class="btn btn-danger fw-bolder px-4 ms-2 fs-8 option" data-id={{option.id}}>Vote</button>
                          {% endif %}
                    </div>
                </div>                
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock content %}

{% block additional_scripts %}
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  {% comment %} {% if voting.is_current and request.user.is_authenticated %} {% endcomment %}
  <script type="text/javascript">
    $(document).on('click', '.option', function(e) {
      e.preventDefault()
      const optionId = $(this).attr('data-id')
      const votedButton = $(".voted-option")
      $.ajax({
        type: "POST",
        url: "{{request.path}}",
        data: {
          option: optionId,
          voting: {{voting.id}},
          csrfmiddlewaretoken: '{{ csrf_token }}',
        },
        success: (res) => {
          $(this).removeClass('btn-danger option').addClass('btn-success voted-option');
          $(this).html("Your vote accepted");
          votedButton.html("Vote")
          votedButton.removeClass('btn-success voted-option').addClass('btn-danger option');
          console.log("Success")
        },
        error: (e) => {
          const alert = $('.alert')
          alert.show('medium')
          setTimeout(function(){
            alert.hide('medium')
          }, 5000)
        }
      })
    })
  </script>
  {% comment %} {% endif %} {% endcomment %}
{% endblock additional_scripts %}